var C=Object.defineProperty;var E=(a,e,t)=>e in a?C(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var r=(a,e,t)=>(E(a,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const h of i)if(h.type==="childList")for(const o of h.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const h={};return i.integrity&&(h.integrity=i.integrity),i.referrerPolicy&&(h.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?h.credentials="include":i.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function s(i){if(i.ep)return;i.ep=!0;const h=t(i);fetch(i.href,h)}})();const c=class{constructor(e,t){r(this,"x");r(this,"y");this.x=e,this.y=t}add(e,t){return e instanceof c?(this.x+=e.x,this.y+=e.y):t?(this.x+=e,this.y+=t):(this.x+=e,this.y+=e),this}static add(e,t){return new c(e.x+t.x,e.y+t.y)}mult(e,t){return e instanceof c?(this.x*=e.x,this.y*=e.y):t?(this.x*=e,this.y*=t):(this.x*=e,this.y*=e),this}static mult(e,t){return t instanceof c?new c(e.x*t.x,e.y*t.y):new c(e.x*t,e.y*t)}sub(e,t){return e instanceof c?(this.x-=e.x,this.y-=e.y):t?(this.x-=e,this.y-=t):(this.x-=e,this.y-=e),this}static sub(e,t){return new c(e.x-t.x,e.y-t.y)}div(e,t){return e instanceof c?(this.x/=e.x,this.y/=e.y):t?(this.x/=e,this.y/=t):(this.x/=e,this.y/=e),this}static div(e,t){return new c(e.x/t.x,e.y/t.y)}set(e,t){return e instanceof c?(this.x=e.x,this.y=e.y):t?(this.x=e,this.y=t):(this.x=e,this.y=e),this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}static mag(e){return Math.sqrt(e.x*e.x+e.y*e.y)}magSq(){return this.x*this.x+this.y*this.y}static magSq(e){return e.x*e.x+e.y*e.y}setMag(e){let t=this.mag();return this.x*=e/t,this.y*=e/t,this}normalize(){return this.setMag(1),this}limit(e){return this.mag()>e&&this.setMag(e),this}heading(){return Math.atan2(this.y,this.x)}rotate(e){let t=Math.cos(e),s=Math.sin(e),i=t*this.x-s*this.y,h=t*this.y+s*this.x;return this.x=i,this.y=h,this}rotateAboutAxis(e,t){return this.sub(t).rotate(e).add(t),this}dot(e){return e.x*this.x+e.y*this.y}static dot(e,t){return e.x*t.x+e.y*t.y}cross(e){return this.x*e.y-this.y*e.x}static cross(e,t){return e.x*t.y-e.y*t.x}dist(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}static dist(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}lerp(e,t){let s=e.x-this.x,i=e.y-this.y;return this.x+=t*s,this.y+=t*i,this}static angleBetween(e,t){return Math.atan2(e.x*t.y-e.y*t.x,e.x*t.x+e.y*t.y)}copy(){return new c(this.x,this.y)}};let n=c;r(n,"ZERO",new c(0,0)),r(n,"UP",new c(0,-1)),r(n,"DOWN",new c(0,1)),r(n,"LEFT",new c(-1,0)),r(n,"RIGHT",new c(1,0));function q(a,e){return n.sub(a,e.copy().mult(2*n.dot(a,e)/e.magSq()))}function P(a,e,t,s){let i=Math.atan2(a.y,a.x)-Math.atan2(e.y,e.x);if(i>Math.PI&&(i=-(Math.PI*2-i)),i<-Math.PI&&(i=Math.PI*2+i),i>Math.PI/2||i<-Math.PI/2){let h=Math.PI-i,o=Math.asin(Math.sin(h)/t),l=h-o;return a.copy().rotate(l)}else{let h=i;if(h>s||h<-s)return q(a,e);let o=Math.asin(Math.sin(h)*t),l=h-o;return a.copy().rotate(-l)}}function k(a,e,t,s){let i=n.sub(e,a),h=n.sub(a,t),o=n.cross(s,i),l=n.cross(h,i)/o,u=n.cross(h,s)/o;return l>=0&&u>=0&&u<=1?n.add(t,s.mult(l)):null}function L(a,e,t,s=.1){let i=n.sub(a,t).mag(),h=n.sub(e,t).mag(),o=n.sub(e,a).mag();return Math.abs(i+h-o)<s}function W(a,e,t){let s=n.sub(t,a),i=n.dot(s,e)/e.magSq();return n.add(a,e.mult(i))}class y{constructor(e,t){r(this,"start");r(this,"end");this.start=e,this.end=t}render(e){e.strokeStyle="#8424b9",e.lineWidth=1,e.strokeRect(this.start.x,this.start.y,this.end.x-this.start.x,this.end.y-this.start.y)}static fromPoints(e){let t=e[0].copy(),s=e[0].copy();for(let i of e)i.x<t.x?t.x=i.x:i.x>s.x&&(s.x=i.x),i.y<t.y?t.y=i.y:i.y>s.y&&(s.y=i.y);return new y(t,s)}static fromAABBs(e){const t=[];for(let s of e)t.push(s.start,s.end);return y.fromPoints(t)}}class b{}class z extends b{constructor(t,s,i,h){super();r(this,"center");r(this,"radius");r(this,"facing");r(this,"span");r(this,"canIntersectTwice",!0);this.center=t,this.radius=s,this.facing=i,this.span=h}intersects(t,s){let i=W(t.copy(),s.copy(),this.center),h=n.sub(i,this.center).magSq();if(h>this.radius*this.radius)return null;let o=Math.sqrt(this.radius*this.radius-h);if(n.sub(t,i).magSq()>o*o){let u=n.sub(i,s.copy().normalize().mult(o));if(!(Math.abs(n.angleBetween(n.sub(u,t),s))>.2)){let d=n.sub(u,this.center);if(Math.abs(n.angleBetween(d,this.facing))<=this.span/2&&t.dist(u)>.01)return u}}let l=n.add(i,s.copy().normalize().mult(o));if(!(Math.abs(n.angleBetween(n.sub(l,t),s))>.2)){let u=n.sub(l,this.center);if(Math.abs(n.angleBetween(u,this.facing))<=this.span/2&&t.dist(l)>.01)return l}return null}translate(t){this.center.add(t)}rotateAboutAxis(t,s){this.center.rotateAboutAxis(t,s),this.facing.rotate(t)}calculateAABB(){const t=[n.UP,n.DOWN,n.LEFT,n.RIGHT],s=[];for(const i of t)Math.abs(n.angleBetween(i,this.facing))<this.span/2&&s.push(n.add(this.center,n.mult(i,this.radius)));return s.push(n.add(this.center,n.mult(this.facing.copy().rotate(this.span/2),this.radius))),s.push(n.add(this.center,n.mult(this.facing.copy().rotate(-this.span/2),this.radius))),y.fromPoints(s)}render(t){let s=this.facing.heading()-this.span/2,i=this.facing.heading()+this.span/2;t.beginPath(),t.strokeStyle="white",t.lineWidth=2,t.arc(this.center.x,this.center.y,this.radius,s,i),t.stroke()}}class p extends z{constructor(t,s,i,h,o,l=1){super(t,s,i,h);r(this,"refractiveIndex");r(this,"criticalAngle");r(this,"normal");this.refractiveIndex=o,this.criticalAngle=Math.asin(1/this.refractiveIndex),this.normal=l}handle(t,s){let i=n.sub(t,this.center).normalize().mult(this.normal);return P(s,i,this.refractiveIndex,this.criticalAngle)}}class N extends b{constructor(t,s){super();r(this,"v1");r(this,"v2");r(this,"normal",new n(0,0));r(this,"canIntersectTwice",!1);this.v1=t,this.v2=s,this.calculateNormal()}calculateNormal(){this.normal=n.sub(this.v2,this.v1).rotate(Math.PI/2).normalize()}setVertices(t,s){this.v1=t.copy(),this.v2=s.copy(),this.calculateNormal()}translate(t){this.v1.add(t),this.v2.add(t),this.calculateNormal()}rotateAboutAxis(t,s){this.v1.rotateAboutAxis(t,s),this.v2.rotateAboutAxis(t,s),this.calculateNormal()}intersects(t,s){return k(this.v1.copy(),this.v2.copy(),t.copy(),s.copy())}intersectsPoint(t,s=.1){return L(this.v1.copy(),this.v2.copy(),t.copy(),s)}calculateAABB(){return y.fromPoints([this.v1,this.v2])}render(t){t.strokeStyle="white",t.lineWidth=2,t.beginPath(),t.moveTo(this.v1.x,this.v1.y),t.lineTo(this.v2.x,this.v2.y),t.stroke();const s=n.add(this.v1,this.v2).mult(.5);t.strokeStyle="red",t.lineWidth=1,t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(s.x+this.normal.x*50,s.y+this.normal.y*50),t.stroke()}}class x extends N{constructor(t,s,i){super(t,s);r(this,"refractiveIndex");r(this,"criticalAngle");this.refractiveIndex=i,this.criticalAngle=Math.asin(1/this.refractiveIndex)}handle(t,s){return P(s,this.normal,this.refractiveIndex,this.criticalAngle)}}class A{constructor(e){r(this,"pos");r(this,"rot");r(this,"bounds");this.pos=e,this.rot=0,this.bounds=new y(n.ZERO,n.ZERO)}setPosition(e){const t=n.sub(e,this.pos);this.updateTransforms(t,0),this.updateBounds()}translate(e){this.pos.add(e),this.updateTransforms(e,0),this.updateBounds()}rotate(e){this.rot+=e,this.updateTransforms(n.ZERO,e),this.updateBounds()}updateTransforms(e,t){}updateBounds(){}}class w extends A{constructor(t){super(t);r(this,"surfaces");this.surfaces=[]}updateTransforms(t,s){for(let i of this.surfaces)i.translate(t),i.rotateAboutAxis(s,this.pos)}updateBounds(){let t=[];for(let s of this.surfaces){const i=s.calculateAABB();t.push(i)}this.bounds=y.fromAABBs(t)}addToWorld(t){for(let s of this.surfaces)t.addSurface(s)}handleClick(t){return!1}render(t){for(let s of this.surfaces)s.render(t);this.bounds.render(t)}}class F extends w{constructor(t){super(t);r(this,"span");r(this,"radiusOfCurvature");r(this,"thickness");r(this,"refractiveIndex");this.span=.4,this.radiusOfCurvature=500,this.thickness=4,this.refractiveIndex=1.666;let s=this.radiusOfCurvature+this.thickness/2,i=this.radiusOfCurvature*Math.sin(this.span/2),h=this.radiusOfCurvature-Math.cos(this.span/2)*this.radiusOfCurvature+this.thickness/2;this.surfaces=[new p(new n(t.x-s,t.y),this.radiusOfCurvature,new n(1,0),this.span,this.refractiveIndex,-1),new p(new n(t.x+s,t.y),this.radiusOfCurvature,new n(-1,0),this.span,this.refractiveIndex,-1),new x(new n(t.x-h,t.y+i),new n(t.x+h,t.y+i),this.refractiveIndex),new x(new n(t.x+h,t.y-i),new n(t.x-h,t.y-i),this.refractiveIndex)],this.updateBounds()}}class D extends w{constructor(t){super(t);r(this,"angle");r(this,"span");r(this,"radiusOfCurvature");r(this,"refractiveIndex");this.span=1,this.radiusOfCurvature=200,this.refractiveIndex=1.666,this.angle=0;let s=this.radiusOfCurvature*Math.sin(this.span/2),i=Math.sqrt(this.radiusOfCurvature**2-s**2);this.surfaces=[new p(new n(t.x-i,t.y),this.radiusOfCurvature,new n(1,0),this.span,this.refractiveIndex),new p(new n(t.x+i,t.y),this.radiusOfCurvature,new n(-1,0),this.span,this.refractiveIndex)],this.updateBounds()}}class Z extends w{constructor(t){super(t);r(this,"radius");r(this,"refractiveIndex");this.radius=100,this.refractiveIndex=1.666,this.surfaces=[new p(t,this.radius,new n(1,0),Math.PI*2,this.refractiveIndex)],this.updateBounds()}}class G{constructor(e,t){r(this,"origin");r(this,"dir");r(this,"path");this.origin=e,this.dir=t.copy(),this.path=[this.origin]}trace(e){this.path=[this.origin];let t=this.path[0],s=this.dir.copy(),i=null;for(let h=0;h<50;h++){let o=null,l=null,u=1/0;for(let d=0;d<e.length;d++){if(d===i&&!e[d].canIntersectTwice)continue;let m=e[d].intersects(t.copy(),s.copy());if(!m)continue;let M=n.sub(m,t).magSq();M<u&&(o=m,u=M,l=d)}if(o&&l!==null)this.path.push(o),t=o,s=e[l].handle(o.copy(),s.copy()).copy(),i=l;else break}this.path.push(t.copy().add(s.mult(3e3)))}render(e){e.moveTo(this.origin.x,this.origin.y);for(let t of this.path)e.lineTo(t.x,t.y)}}class H extends A{constructor(t){super(t);r(this,"numRays");r(this,"lightRays");this.numRays=1e3,this.lightRays=[];for(let s=0;s<this.numRays;s++)this.lightRays.push(new G(this.pos,new n(1,0).rotate(Math.PI*2/this.numRays*s)))}setPosition(t){this.pos=t;for(let s of this.lightRays)s.origin=t}addToWorld(t){for(let s of this.lightRays)t.addLightRay(s)}handleClick(t){return!1}render(t){}}const v=[new n(0,-Math.sqrt(3)/3),new n(.5,Math.sqrt(3)/6),new n(-.5,Math.sqrt(3)/6)];class U extends w{constructor(t){super(t);r(this,"size");r(this,"refractiveIndex");this.size=200,this.refractiveIndex=1.5;let s=n.add(this.pos,v[0].copy().mult(this.size).rotate(this.rot)),i=n.add(this.pos,v[1].copy().mult(this.size).rotate(this.rot)),h=n.add(this.pos,v[2].copy().mult(this.size).rotate(this.rot));this.surfaces=[new x(i,s,this.refractiveIndex),new x(h,i,this.refractiveIndex),new x(s,h,this.refractiveIndex)],this.updateBounds()}}class X{constructor(){r(this,"surfaces",[]);r(this,"lightRays",[]);r(this,"entities",[])}addSurface(e){this.surfaces.push(e)}addLightRay(e){this.lightRays.push(e)}addEntity(e){this.entities.push(e),e.addToWorld(this)}update(){for(let e of this.lightRays)e.trace(this.surfaces)}handleClick(e){for(let t of this.entities)t.handleClick(e)}render(e){e.beginPath();for(let t of this.lightRays)t.render(e);e.strokeStyle="rgba(255, 255, 255, 0.2)",e.lineWidth=1,e.stroke();for(let t of this.entities)t.render(e)}}const g=document.getElementById("display"),I=g.getContext("2d");g.width=window.innerWidth;g.height=window.innerHeight;const f=new X,O=new U(new n(200,150));f.addEntity(O);const R=new H(new n(700,400));f.addEntity(R);let B=new D(new n(800,300));f.addEntity(B);let S=new F(new n(500,300));f.addEntity(S);let Y=new Z(new n(200,500));f.addEntity(Y);window.addEventListener("click",a=>{f.handleClick(new n(a.clientX,a.clientY))});window.addEventListener("mousemove",a=>{R.setPosition(new n(a.clientX,a.clientY))});function T(){requestAnimationFrame(T),I.fillStyle="black",I.fillRect(0,0,g.width,g.height),O.rotate(-.001),B.rotate(-.005),S.rotate(.005),f.update(),f.render(I)}T();
