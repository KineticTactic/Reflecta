var R=Object.defineProperty;var q=(h,t,e)=>t in h?R(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var a=(h,t,e)=>(q(h,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();class v{constructor(t){a(this,"pos");this.pos=t}}class i{constructor(t,e){a(this,"x");a(this,"y");this.x=t,this.y=e}add(t,e){return t instanceof i?(this.x+=t.x,this.y+=t.y):e?(this.x+=t,this.y+=e):(this.x+=t,this.y+=t),this}static add(t,e){return new i(t.x+e.x,t.y+e.y)}mult(t,e){return t instanceof i?(this.x*=t.x,this.y*=t.y):e?(this.x*=t,this.y*=e):(this.x*=t,this.y*=t),this}static mult(t,e){return new i(t.x*e.x,t.y*e.y)}sub(t,e){return t instanceof i?(this.x-=t.x,this.y-=t.y):e?(this.x-=t,this.y-=e):(this.x-=t,this.y-=t),this}static sub(t,e){return new i(t.x-e.x,t.y-e.y)}div(t,e){return t instanceof i?(this.x/=t.x,this.y/=t.y):e?(this.x/=t,this.y/=e):(this.x/=t,this.y/=t),this}static div(t,e){return new i(t.x/e.x,t.y/e.y)}set(t,e){return t instanceof i?(this.x=t.x,this.y=t.y):e?(this.x=t,this.y=e):(this.x=t,this.y=t),this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}static mag(t){return Math.sqrt(t.x*t.x+t.y*t.y)}magSq(){return this.x*this.x+this.y*this.y}static magSq(t){return t.x*t.x+t.y*t.y}setMag(t){let e=this.mag();return this.x*=t/e,this.y*=t/e,this}normalize(){return this.setMag(1),this}limit(t){return this.mag()>t&&this.setMag(t),this}heading(){return Math.atan2(this.y,this.x)}rotate(t){let e=Math.cos(t),s=Math.sin(t),n=e*this.x-s*this.y,r=e*this.y+s*this.x;return this.x=n,this.y=r,this}dot(t){return t.x*this.x+t.y*this.y}static dot(t,e){return t.x*e.x+t.y*e.y}cross(t){return this.x*t.y-this.y*t.x}static cross(t,e){return t.x*e.y-t.y*e.x}dist(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}static dist(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}lerp(t,e){let s=t.x-this.x,n=t.y-this.y;return this.x+=e*s,this.y+=e*n,this}static angleBetween(t,e){return Math.atan2(t.x*e.y-t.y*e.x,t.x*e.x+t.y*e.y)}copy(){return new i(this.x,this.y)}}class T{constructor(t,e){a(this,"origin");a(this,"dir");a(this,"path");this.origin=t,this.dir=e.copy(),this.path=[this.origin]}trace(t){this.path=[this.origin];let e=this.path[0],s=this.dir.copy(),n=null;for(let r=0;r<500;r++){let l=null,o=null,u=1/0;for(let c=0;c<t.length;c++){if(c===n&&!t[c].canIntersectTwice)continue;let d=t[c].intersects(e.copy(),s.copy());if(!d)continue;let g=i.sub(d,e).magSq();g<u&&(l=d,u=g,o=c)}if(l&&o!==null)this.path.push(l),e=l,s=t[o].handle(l.copy(),s.copy()).copy(),n=o;else break}this.path.push(e.copy().add(s.mult(2e3)))}render(t){t.beginPath(),t.moveTo(this.origin.x,this.origin.y);for(let e of this.path)t.lineTo(e.x,e.y);t.strokeStyle="rgba(255, 255, 255, 0.1)",t.lineWidth=1,t.stroke()}}class b extends v{constructor(e){super(e);a(this,"size");a(this,"numRays");a(this,"lightRays");this.size=100,this.numRays=1e3,this.lightRays=[];for(let s=-this.size/2;s<=this.size/2;s+=this.size/this.numRays)this.lightRays.push(new T(i.add(this.pos,new i(0,s)),new i(1,0)))}addToWorld(e){for(let s of this.lightRays)e.addLightRay(s)}handleClick(e){return!1}render(e){for(let s of this.lightRays)s.render(e)}}function z(h,t,e,s){let n=i.sub(t,h),r=i.sub(h,e),l=i.cross(s,n),o=i.cross(r,n)/l,u=i.cross(r,s)/l;return o>=0&&u>=0&&u<=1?i.add(e,s.mult(o)):null}function E(h,t,e,s=.1){let n=i.sub(h,e).mag(),r=i.sub(t,e).mag(),l=i.sub(t,h).mag();return Math.abs(n+r-l)<s}function k(h,t,e){let s=i.sub(e,h),n=i.dot(s,t)/t.magSq();return i.add(h,t.mult(Math.max(n,0)))}class I{}class A extends I{constructor(e,s){super();a(this,"v1");a(this,"v2");a(this,"normal",new i(0,0));a(this,"canIntersectTwice",!1);this.v1=e,this.v2=s,this.calculateNormal()}calculateNormal(){this.normal=i.sub(this.v2,this.v1).rotate(Math.PI/2).normalize()}setVertices(e,s){this.v1=e.copy(),this.v2=s.copy(),this.calculateNormal()}intersects(e,s){return z(this.v1.copy(),this.v2.copy(),e.copy(),s.copy())}intersectsPoint(e,s=.1){return E(this.v1.copy(),this.v2.copy(),e.copy(),s)}render(e){e.strokeStyle="white",e.lineWidth=2,e.beginPath(),e.moveTo(this.v1.x,this.v1.y),e.lineTo(this.v2.x,this.v2.y),e.stroke();const s=i.add(this.v1,this.v2).mult(.5);e.strokeStyle="red",e.lineWidth=1,e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(s.x+this.normal.x*50,s.y+this.normal.y*50),e.stroke()}}function M(h,t){return i.sub(h,t.copy().mult(2*i.dot(h,t)/t.magSq()))}class x extends A{constructor(e,s,n){super(e,s);a(this,"refractiveIndex");a(this,"criticalAngle");this.refractiveIndex=n,this.criticalAngle=Math.asin(1/this.refractiveIndex)}handle(e,s){let n=Math.atan2(s.y,s.x)-Math.atan2(this.normal.y,this.normal.x);if(n>Math.PI/2||n<-Math.PI/2){let r=Math.PI-n,l=Math.asin(Math.sin(r)/this.refractiveIndex),o=r-l;return s.copy().rotate(o)}else{let r=n;if(r>this.criticalAngle||r<-this.criticalAngle)return M(s,this.normal);let l=Math.asin(Math.sin(r)*this.refractiveIndex),o=r-l;return s.copy().rotate(-o)}}}class L{constructor(t){a(this,"pos");a(this,"radius");a(this,"state");this.pos=t,this.radius=6,this.state=0}update(t,e){e||(this.state=0),this.state===2?(this.pos=t.copy(),e||(this.state=0)):this.state===1?e&&(this.state=2):t.dist(this.pos)<this.radius?this.state=1:this.state=0}render(t){let e=this.state===1?this.radius*1.5:this.radius;t.beginPath(),t.arc(this.pos.x,this.pos.y,e,0,2*Math.PI),t.fillStyle="yellow",t.fill()}}const f=[new i(0,-Math.sqrt(3)/3),new i(.5,Math.sqrt(3)/6),new i(-.5,Math.sqrt(3)/6)];class O extends v{constructor(e){super(e);a(this,"angle");a(this,"size");a(this,"refractiveIndex");a(this,"surfaces");a(this,"posDrag");this.size=200,this.refractiveIndex=1.5,this.angle=0,this.posDrag=new L(e);let s=i.add(this.pos,f[0].copy().mult(this.size).rotate(this.angle)),n=i.add(this.pos,f[1].copy().mult(this.size).rotate(this.angle)),r=i.add(this.pos,f[2].copy().mult(this.size).rotate(this.angle));this.surfaces=[new x(n,s,this.refractiveIndex),new x(r,n,this.refractiveIndex),new x(s,r,this.refractiveIndex)],this.recalculateVertices()}addToWorld(e){for(let s of this.surfaces)e.addSurface(s)}rotate(e){this.angle+=e,this.recalculateVertices()}recalculateVertices(){let e=i.add(this.pos,f[0].copy().mult(this.size).rotate(this.angle)),s=i.add(this.pos,f[1].copy().mult(this.size).rotate(this.angle)),n=i.add(this.pos,f[2].copy().mult(this.size).rotate(this.angle));this.surfaces[0].setVertices(s,e),this.surfaces[1].setVertices(n,s),this.surfaces[2].setVertices(e,n)}handleClick(e){for(let s of this.surfaces)if(s.intersectsPoint(e,10))return console.log("YEE"),!0;return!1}render(e){for(let s of this.surfaces)s.render(e)}}class B extends I{constructor(e,s,n,r){super();a(this,"center");a(this,"radius");a(this,"facing");a(this,"span");a(this,"canIntersectTwice",!0);this.center=e,this.radius=s,this.facing=n,this.span=r}intersects(e,s){let n=k(e.copy(),s.copy(),this.center),r=i.sub(n,this.center).magSq();if(r>this.radius*this.radius)return null;let l=Math.sqrt(this.radius*this.radius-r);if(i.sub(e,n).magSq()>l*l){let d=i.sub(n,s.copy().normalize().mult(l)),g=i.sub(d,this.center);if(Math.abs(i.angleBetween(g,this.facing))<=this.span/2&&e.dist(d)>.01)return d}let o=i.add(n,s.copy().normalize().mult(l)),u=i.sub(o,this.center);return Math.abs(i.angleBetween(u,this.facing))<=this.span/2&&e.dist(o)>.01?o:null}render(e){let s=this.facing.heading()-this.span/2,n=this.facing.heading()+this.span/2;e.beginPath(),e.strokeStyle="white",e.lineWidth=2,e.arc(this.center.x,this.center.y,this.radius,s,n),e.stroke()}}class C extends B{constructor(t,e,s,n){super(t,e,s,n)}handle(t,e){let s=i.sub(t,this.center).normalize();return M(e,s)}}class W{constructor(){a(this,"surfaces",[]);a(this,"lightRays",[]);a(this,"entities",[])}addSurface(t){this.surfaces.push(t)}addLightRay(t){this.lightRays.push(t)}addEntity(t){this.entities.push(t),t.addToWorld(this)}update(){for(let t of this.lightRays)t.trace(this.surfaces)}handleClick(t){for(let e of this.entities)e.handleClick(t)}render(t){for(let e of this.lightRays)e.render(t);for(let e of this.entities)e.render(t)}}const p=document.getElementById("display"),m=p.getContext("2d");p.width=window.innerWidth;p.height=window.innerHeight;const y=new W,P=new O(new i(200,150));y.addEntity(P);y.addEntity(new b(new i(300,300)));const w=new C(new i(700,300),100,new i(-1,0),3);y.addSurface(w);window.addEventListener("click",h=>{y.handleClick(new i(h.clientX,h.clientY))});function S(){requestAnimationFrame(S),m.fillStyle="black",m.fillRect(0,0,p.width,p.height),P.rotate(-.001),w.facing.rotate(.005),y.update(),w.render(m),y.render(m)}S();
